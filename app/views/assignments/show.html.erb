<div class="container mx-auto px-4 py-8">

  <h1 class="text-2xl font-bold"><%= @assignment.title %></h1>
  <% if @assignment.passage.present? %>
    <div class="mt-6 bg-white rounded-lg shadow px-16 py-12">
      <div class="mb-16">
        <%= markdown(@assignment.markdown_passage) %>
      </div>
    
    <h2 class="text-3xl font-normal mb-6">Questions</h2>
      <div class="space-y-4">
        <% @questions.each_with_index do |question, index| %>
          <%= render "questions/question", question: question, question_counter: index %>
        <% end %>
      </div>
    </div>

  <% end %>

  <div class="mb-8">
    <div class="flex justify-between items-center">
      
      
      <% if Current.user.teacher? && @assignment.teachers.include?(Current.user) %>
        <div class="flex gap-4">
          <%= link_to "Edit", edit_assignment_path(@assignment), 
              class: "bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded" %>
          <%= button_to "Delete", assignment_path(@assignment), 
              method: :delete,
              class: "bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded",
              data: { confirm: "Are you sure you want to delete this assignment?" } %>
        </div>
      <% end %>
    </div>

    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold mb-4">Assignment Details</h2>
        <div class="space-y-2">
          <p><strong>Subject:</strong> <%= @assignment.subject %></p>
          <p><strong>Grade Level:</strong> <%= @assignment.grade_level %></p>
          <p><strong>Difficulty:</strong> <%= @assignment.difficulty %></p>
          <p><strong>Questions:</strong> <%= @assignment.number_of_questions %></p>
          <p><strong>Interests:</strong> <%= @assignment.interests %></p>
        </div>
      </div>

      <% if Current.user.teacher? %>
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">Assign to Students</h2>
          <%= form_with url: assign_students_assignment_path(@assignment), method: :post, class: "space-y-4" do |f| %>
            <div class="space-y-2">
              <% User.students.each do |student| %>
                <div class="flex items-center">
                  <%= check_box_tag "student_ids[]", student.id, 
                      @assignment.students.include?(student),
                      id: "student_#{student.id}",
                      class: "mr-2" %>
                  <%= label_tag "student_#{student.id}", student.email_address %>
                </div>
              <% end %>
            </div>
            
            <%= f.submit "Update Student Assignments", 
                class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
          <% end %>
        </div>
      <% else %>
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">Submission Status</h2>
          <% assignment_user = @assignment.assignment_users.find_by(user: Current.user) %>
          
          <%= form_with url: assignment_submissions_path(@assignment), 
              method: :post, 
              local: true, 
              class: "space-y-4" do |f| %>
            <div class="space-y-2">
              <%= f.select :status, AssignmentUser::STATUSES,
                  { selected: assignment_user&.status },
                  class: "w-full p-2 border rounded" %>
            </div>
            
            <%= f.submit "Update Status", 
                class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

</div>