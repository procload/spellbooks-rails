<div class="container mx-auto px-4 py-8">
  <main class="flex-1 p-8 overflow-y-auto">
    <h1 class="text-4xl font-medium mb-8"><%= @assignment.title %></h1>

    <!-- Assignment -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
      <!-- Reading Passage -->
      <div class="mb-6">
        <h3 class="text-xl font-medium mb-2">Reading Passage</h3>
        <div class="text-gray-700 mb-4">
          <p class="mb-4"><%= @assignment.passage %></p>
          <% if @assignment.image.attached? %>
            <div class="inline-block max-w-md mx-auto">
              <%= image_tag @assignment.image, class: "w-full h-auto" %>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Questions -->
      <div class="space-y-8">
        <%= render partial: "questions/question", collection: @questions, as: :question %>
      </div>

      <% if Current.user.teacher? && @assignment.teachers.include?(Current.user) %>
        <div class="mt-8 flex gap-4">
          <%= link_to "Edit", edit_assignment_path(@assignment), 
              class: "bg-warning hover:bg-warning/90 text-destructive-foreground font-bold py-2 px-4 rounded" %>
          <%= button_to "Delete", assignment_path(@assignment), 
              method: :delete,
              class: "bg-destructive hover:bg-destructive/90 text-destructive-foreground font-bold py-2 px-4 rounded",
              data: { confirm: "Are you sure you want to delete this assignment?" } %>
        </div>
      <% end %>
      <div class="flex justify-end mb-4">
        <%= link_to download_pdf_assignment_path(@assignment, format: :pdf), class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" do %>
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          Download PDF
        <% end %>
      </div>
    </div>

    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold mb-4">Assignment Details</h2>
        <div class="space-y-2">
          <p><strong>Subject:</strong> <%= @assignment.subject %></p>
          <p><strong>Grade Level:</strong> <%= @assignment.grade_level %></p>
          <p><strong>Difficulty:</strong> <%= @assignment.difficulty %></p>
          <p><strong>Questions:</strong> <%= @assignment.number_of_questions %></p>
          <p><strong>Interests:</strong> <%= @assignment.interests %></p>
        </div>
      </div>

      <% if Current.user.teacher? %>
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">Assign to Students</h2>
          <%= form_with url: assign_students_assignment_path(@assignment), method: :post, class: "space-y-4" do |f| %>
            <div class="space-y-2">
              <% User.students.each do |student| %>
                <div class="flex items-center">
                  <%= check_box_tag "student_ids[]", student.id, 
                      @assignment.students.include?(student),
                      id: "student_#{student.id}",
                      class: "mr-2" %>
                  <%= label_tag "student_#{student.id}", student.email_address %>
                </div>
              <% end %>
            </div>
            
            <%= f.submit "Update Student Assignments", 
                class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
          <% end %>
        </div>
      <% else %>
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">Submission Status</h2>
          <% assignment_user = @assignment.assignment_users.find_by(user: Current.user) %>
          
          <%= form_with url: assignment_submissions_path(@assignment), 
              method: :post, 
              local: true, 
              class: "space-y-4" do |f| %>
            <div class="space-y-2">
              <%= f.select :status, AssignmentUser::STATUSES,
                  { selected: assignment_user&.status },
                  class: "w-full p-2 border rounded" %>
            </div>
            
            <%= f.submit "Update Status", 
                class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
          <% end %>
        </div>
      <% end %>
    </div>
  </main>
</div>